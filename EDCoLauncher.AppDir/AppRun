#!/bin/bash

# $APPDIR is the path where the AppImage is mounted (Read-Only)
# $OWD (Original Working Directory) is where the user launched the AppImage from

APPDIR="$(dirname "$(readlink -f "${0}")")"
TARGET_DIR="$PWD"  # We use the current directory so config stays with the launcher

# Define paths
INTERNAL_SCRIPT="$APPDIR/usr/bin/EDCoLauncher.sh"
INTERNAL_CONFIG="$APPDIR/usr/bin/EDCoLauncher_config"
EXTERNAL_CONFIG="$TARGET_DIR/EDCoLauncher_config"

# 1. Check if the user has a config file in the current folder.
# If not, copy the default one from inside the AppImage.
if [ ! -f "$EXTERNAL_CONFIG" ]; then
    echo "Creating default configuration file..."
    cp "$INTERNAL_CONFIG" "$EXTERNAL_CONFIG"
fi

# 2. Run the main script
# We pass the location of the script but execute it in the current directory
# so it can find the config file and write logs to $PWD.

exec "$INTERNAL_SCRIPT" "$@"
